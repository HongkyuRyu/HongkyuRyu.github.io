---
title: "[Java] 자바 동시성 프로그래밍: 운영체제"
author: HONGKYU RYU
categories: [Backend, Java]
tag: [Backend, Java]
math: true
---

> Java 동시성 프로그래밍을 이해하기 전에, 운영체제의 기초에 대해 정리하자.

# ✅ 프로세스 vs 스레드 비교

- **`Process`**
    - 프로세스는 독립적으로 자원을 할당받기 때문에, 자식 프로세스 중 하나에 문제가 발생하더라도, 다른 프로세스에 영향을 미치지 않는다.
        - 따라서, 프로그램 전체의 안전성을 확보할 수 있다.
    - 다만, 프로세스 간 전환(컨텍스트 스위칭)시 레지스터, 캐시 메모리 초기화 등 무거운 작업으로 인한 시간적 비용이 크다.
    - 원칙적으로 프로세스 간의 자원은 공유가 안되며, IPC와 같은 통신 기법을 활용할 수 있으나, 통신 기법이 어렵고 복잡하다.
        - 또한, 통신으로 인한 오버헤드가 크다.
    - 프로세스 생성시 독립적으로 4GB라는 메모리가 할당되기 때문에, 리소스 비용이 크다.
- **`Thread`**
    - 여러개의 스레드 중 하나라도 문제가 발생하면, 전체 프로세스에 영향을 준다.
        - 프로세스 자체가 종료될 수 있다.
    - 프로세스의 메모리 영역을 공유하기 때문에 (정확히 말하면, Code, Date, Heap) 컨텍스트 스위칭 시간이 적고, 리소스를 효율적으로 사용한다.
    - 스레드간 통신 비용이 적고, 통신으로 인한 오버헤드가 작다.
    - 다만, 스레드 간 공유 메모리 영역에서 동시 접근으로 동기화 문제가 발생한다.
## ✅ 프로세스 스레드

<aside>
💡 **프로세스** = 최소 작업 단위(운영체제로부터 메모리 자원을 할당받는 최소 작업 단위)
**스레드** = 최소 실행 단위 (CPU를 할당받아, 프로세스 실행을 위한 최소 실행 단위)

</aside>

- 프로그램
    - 운영체제에 의해 파일 시스템에 설치되어 있는 파일을 프로그램이라고 한다.
- 프로세스
    - 프로그램 파일을 실행함으로써, 프로그램 데이터들이 **메모리에 올라와 CPU를 할당받고 명령을 수행하고 있는 상태**이다. (단, CPU를 할당받는 주체는 쓰레드)
    - 즉, 프로세스는 **운영체제로부터 독립된 메모리 자원을 할당받은 `최소 작업 단위`**이다.
![image](https://github.com/HongkyuRyu/HongkyuRyu.github.io/blob/main/assets/posts/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C(1).jpg)
    - 스택
    - `**함수(메서드)**` 안에서 선행된 지역변수, 매개변수, 리턴값 등이 저장된다.
    - **`함수의 호출`**과 함께 할당되어지며, 함수의 호출이 완료되면 소멸된다.
- 힙
    - `**사용자**`에 의해서 **메모리 공간이 동적으로 할당되고 해제**된다.
    - 객체(object), 배열 … 등이 저장된다.
    - 메모리의 낮은 수준 ⇒ 높은 수준으로 할당된다.;

스택은 높은 주소 ⇒ 낮은 주소로 할당되면서, 메모리 사용량을 늘리고, 힙은 낮은 주소 ⇒ 높은 주소로 할당되면서, 메모리 사용량을 늘린다.

- 데이터
    - 코드가 실행하면서, **사용되는 전역변수, static 변수** 이다.
    - **프로그램(애플리케이션)의 시작과 함께 할당되어지며, 프로그램이 종료되면 소멸한다.**
- 코드
    - 사용자가 작성한 프로그램 함수들의 코드
    - CPU는 `코드 영역에 저장된 명령어`를 하나씩 가져가서 처리한다.

---

### ✅ 프로세스가 여러 개 있을 경우

운영체제는 프로세스마다 각각 독립된 메모리 영역을 Code / Data / Stack / Heap 형식으로 할당해준다. 

⇒ 운영체제가 프로세스마다 독립적으로 서로 간의 간섭 없이, 데이터를 처리하고 실행할 수 있는 영역을 할당해준다.

- 기본적으로 다른 프로세스의 변수나 자료에 접근할 수 없다.
- 따라서, **IPC나 공유 메모리 등의 통신 기법 등을 사용해서 프로세스 간 통신을 해야한다.**

![image](https://github.com/HongkyuRyu/HongkyuRyu.github.io/blob/main/assets/posts/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C(2).jpg)

### ✅ 쓰레드

**스레드는 프로세스가 운영체제로부터 할당받은 자원을 이용하는 실행 단위 또는 흐름의 단위**로서 `**하나의 프로세스는 반드시 하나 이상의 스레드**`를 갖는다.

- 하나의 프로세스 안에 여러 쓰레드가 존재할 때, 각 쓰레드마다 스택만 할당받는다.
- `**Code, Date, Heap 영역은**` 각 쓰레드마다 독립적으로 가지는 것이 아닌, `**공유를 한다.**`

![image](https://github.com/HongkyuRyu/HongkyuRyu.github.io/blob/main/assets/posts/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C(3).jpg)

<aside>
💡 프로세스는 프로세스 각각 마다, Stack, Code, Data, Heap 영역을 할당 받는다. 반면, 쓰레드는 쓰레드만을 할당받고, Code, Data, Heap은 쓰레드끼리 서로 공유를 한다.
**쓰레드는 고유의 Stack 영역을 가지기 때문에, 독립적인 실행흐름을 가지게 되어, 독립적인 함수 호출이 가능해진다.**

</aside>

### ✅ 쓰레드와 CPU의 관계

스레드는 운영체제의 `**스케줄러**` 에 의해 관리되는 `**CPU의 실행 단위**`이기도 하다.

- 스레드가 CPU로부터 자원을 할당받아서, 코드를 실행해주기 때문이다. (최소 할당
- 스레드는 **스케줄러의 알고리즘**에 따라 **프로세스에 속한 한 개의 스레드가 선정되어 CPU에 할당**된다. **(반드시, 하나의 CPU는 해당 시점에 하나의 스레드만 선점을 해서 코드를 실행시킨다.)**
- 그리고, 스레드 간의 선점이 일어날 때 CPU의 실행 흐름이 전환되는 컨텍스트 스위칭이 발생한다.
- ⇒ 어떤 쓰레드를 선정할지는 오로지 스케줄러의 책임이다.
![image](https://github.com/HongkyuRyu/HongkyuRyu.github.io/blob/main/assets/posts/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C(4).jpg)
